<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to mELO ratings • mELO</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to mELO ratings">
<meta property="og:description" content="mELO">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mELO</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_introduction.html">Introduction to mELO ratings</a>
    </li>
    <li>
      <a href="../articles/02_afl.html">Application of mELO ratings to AFL matches</a>
    </li>
    <li>
      <a href="../articles/03_noise.html">Impact of noisy or probabilistic outcomes in mELO models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dclaz/mELO/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to mELO ratings</h1>
                        <h4 class="author">David Lazaridis</h4>
            
            <h4 class="date">2020-05-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dclaz/mELO/blob/master/vignettes/01_introduction.Rmd"><code>vignettes/01_introduction.Rmd</code></a></small>
      <div class="hidden name"><code>01_introduction.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><strong>mELO</strong> is an R implementation of DeepMind’s <a href="https://arxiv.org/abs/1806.02643">multidimensional Elo rating</a> (mELO) system for evaluating agents. This package uses code directly from Alec Stephenson and Jeff Sonas’s excellent <a href="https://cran.r-project.org/package=PlayerRatings">PlayerRatings</a> package (v1.0-3, 2019-02-22).</p>
<p><a href="https://arxiv.org/abs/1806.02643">Balduzzi, et al. (2018)</a> proposed that a rating/evaluation method should have the following properties:</p>
<ul>
<li>
<strong>P1.</strong> <em>Invariant</em>: adding redundant copies of an agent or task to the data should make no difference.</li>
<li>
<strong>P2.</strong> <em>Continuous</em>: the evaluation method should be robust to small changes in the data.</li>
<li>
<strong>P3.</strong> <em>Interpretable</em>: hard to formalize, but the procedure should agree with intuition in basic cases.</li>
</ul>
<p>Typical methods for performing pairwise comparisons such as Elo or Glicko violate <strong>P1</strong> and can result in poor evaluations of agents and predictions of outcomes.</p>
<p>Additionally, typical methods can perform poorly in an environment where there exist <strong>cyclical</strong> or <strong>non-transitive interactions</strong> between agents or players. Below we demonstrate the utility of the mELO package with some simple examples.</p>
</div>
<div id="evaluating-agents-with-non-transitive-interactions" class="section level1">
<h1 class="hasAnchor">
<a href="#evaluating-agents-with-non-transitive-interactions" class="anchor"></a>Evaluating agents with non-transitive interactions</h1>
<p>We provide some examples of how the <strong>mELO</strong> package can be used to evaluate agents and predict outcomes in the presence of non-transitive interactions. The examples are <em>trivial</em> but do demonstrate the weaknesses of existing methods and the utility of the mELO approach.</p>
<div id="rock-paper-scissors" class="section level2">
<h2 class="hasAnchor">
<a href="#rock-paper-scissors" class="anchor"></a>Rock-Paper-Scissors</h2>
<p>Out first model will evaluate throws in the 2-player game of <a href="https://en.wikipedia.org/wiki/Rock_paper_scissors">Rock-Paper-Scissors</a>. The direction of the arrows in the figure below give the winner of each thrown pair</p>
<p align="center">
<img src="images/rps.png"></p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># Load packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mELO</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)

<span class="co"># Inspect data</span>
<span class="no">rps_df</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>() <span class="kw">%&gt;%</span> <span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">time_index</th>
<th align="left">throw_1</th>
<th align="left">throw_2</th>
<th align="right">outcome</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">PAPER</td>
<td align="left">ROCK</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">ROCK</td>
<td align="left">SCISSORS</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">SCISSORS</td>
<td align="left">PAPER</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">ROCK</td>
<td align="left">PAPER</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">SCISSORS</td>
<td align="left">ROCK</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">PAPER</td>
<td align="left">SCISSORS</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The second and third columns give the throws chosen. A 1 in the outcome field denotes a win for throw 1, 0 denotes a win for throw 2. The <code>rps_df</code> data has 120 matches.</p>
<div id="elo-model" class="section level3">
<h3 class="hasAnchor">
<a href="#elo-model" class="anchor"></a>ELO model</h3>
<p>The predictions probabilities estimated by an Elo model are given by <span class="math display">\[ 
  \hat{p}_{ij} = \sigma (\alpha(r_i + \gamma_i - r_j))
\]</span> Where <span class="math inline">\(\hat{p}_{ij}\)</span> is the estimated probability of player <span class="math inline">\(i\)</span> beating player <span class="math inline">\(j\)</span>, <span class="math inline">\(r_i\)</span> is the current rating of player <span class="math inline">\(i\)</span>, <span class="math inline">\(\alpha = \ln(10)/400\)</span>, <span class="math inline">\(\gamma_i\)</span> represents the first move or home ground advantage for player <span class="math inline">\(i\)</span> and <span class="math display">\[
  \sigma(x) = \frac{1}{(1+ e^{-x})}.
\]</span></p>
<p>After a match at time <span class="math inline">\(t\)</span>, the following rule is used to update ratings <span class="math display">\[
  r_i^{t+1} = r^t_i + \eta \delta_{ij}
\]</span> where <span class="math inline">\(\eta\)</span> is the learning rate and <span class="math inline">\(\delta = \hat{p}_{ij} - y\)</span> where <span class="math inline">\(y \in \{0, 1\}\)</span> is the outcome of the match for player <span class="math inline">\(i\)</span>.</p>
<p>The following code fits a standard Elo model using the <code><a href="../reference/ELO.html">ELO()</a></code> function with a default <code>eta</code> (the learning rate) and <code>p1_advantage</code> (Player 1 advantage i.e; first mover or home ground advantage).</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Fit model</span>
<span class="no">rps_ELO</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ELO.html">ELO</a></span>(<span class="no">rps_df</span>)
<span class="co"># Display output</span>
<span class="no">rps_ELO</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ELO Ratings For 3 Players Playing 120 Games</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Player Rating Games Win Draw Loss Lag</span>
<span class="co">#&gt; 1 SCISSORS 2204.6    80  40    0   40   0</span>
<span class="co">#&gt; 2     ROCK 2204.6    80  40    0   40   1</span>
<span class="co">#&gt; 3    PAPER 2190.7    80  40    0   40   0</span></pre></body></html></div>
<p>Now we can generate some predictions on a sample of the data and compare them to the actual outcomes</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">rps_ELO_preds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(
    <span class="no">rps_ELO</span>,
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">rps_df</span>)
)

<span class="no">results_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">rps_df</span>),
    <span class="kw">ELO_preds</span> <span class="kw">=</span> <span class="no">rps_ELO_preds</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">3</span>)
)
<span class="no">results_df</span> <span class="kw">%&gt;%</span> <span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">time_index</th>
<th align="left">throw_1</th>
<th align="left">throw_2</th>
<th align="right">outcome</th>
<th align="right">ELO_preds</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">PAPER</td>
<td align="left">ROCK</td>
<td align="right">1</td>
<td align="right">0.48</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">ROCK</td>
<td align="left">SCISSORS</td>
<td align="right">1</td>
<td align="right">0.50</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">SCISSORS</td>
<td align="left">PAPER</td>
<td align="right">1</td>
<td align="right">0.52</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">ROCK</td>
<td align="left">PAPER</td>
<td align="right">0</td>
<td align="right">0.52</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">SCISSORS</td>
<td align="left">ROCK</td>
<td align="right">0</td>
<td align="right">0.50</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">PAPER</td>
<td align="left">SCISSORS</td>
<td align="right">0</td>
<td align="right">0.48</td>
</tr>
</tbody>
</table>
<p>We observe that the Elo predictions are very poor. We can plot the history of the ratings using the <code><a href="https://rdrr.io/r/base/plot.html">plot()</a></code> function</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">rps_ELO</span>)</pre></body></html></div>
<p><img src="01_introduction_files/figure-html/rps_ELO_3-1.png" width="700"></p>
<p>We note that the ratings bounce up and down as the throws consistently lose and win to the same players.</p>
<p>Because the ability of an agent is described by a single parameter, the Elo ratings bake-in the assumption that relative abilities are transitive. This assumption is clearly inappropriate in this setting (and likely many others). The Elo model completely fails to capture the dynamics of this simple game and cannot be used to adequately rate or evaluate throws or predict outcomes.</p>
</div>
<div id="melo-model" class="section level3">
<h3 class="hasAnchor">
<a href="#melo-model" class="anchor"></a>mELO model</h3>
<p>The success probabilities estimated by an mELO model are given by <span class="math display">\[ 
  \hat{p}_{ij} = \sigma (\alpha(r_i + \gamma_i - r_j + \textbf{c}_i \Omega \textbf{c}_j' ))
\]</span> where <span class="math inline">\(\Omega\)</span> is a <span class="math inline">\(2k \times 2k\)</span> matrix constructed such that <span class="math display">\[
  \Omega = \sum_{i=1}^{k} (\textbf{e}_{2i-1} \textbf{e}_{2i}' - \textbf{e}_{2i} \textbf{e}_{2i-1}')
\]</span> and <span class="math inline">\(\textbf{c}_i\)</span> is a row vector of the <span class="math inline">\(m \times 2k\)</span> dimension <span class="math inline">\(\textbf{C}\)</span> matrix which encodes the non-transitive interactions between the <span class="math inline">\(m\)</span> agents or players. <span class="math inline">\(\textbf{e}_j\)</span> are standard basis vectors spanning the columns of <span class="math inline">\(\Omega\)</span>. Larger <span class="math inline">\(k\)</span> allows for better estimates in situations with more complex dynamics, which we will observe later.</p>
<p>After a match, the following rules are used to update ratings <span class="math display">\[
  r_i^{t+1} = r^t_i + \eta_1 \delta_{ij},
\]</span> <span class="math display">\[
\textbf{c}_i^{t+1} = \textbf{c}^t_i + \eta_2 \delta_{ij} \Omega \textbf{c}^t_j
\]</span> where <span class="math inline">\(\eta_1\)</span> and <span class="math inline">\(\eta_2\)</span> are the learning rates for the ratings vector <span class="math inline">\(\textbf{r}\)</span> and <span class="math inline">\(\textbf{C}\)</span> matrix respectively.</p>
<p>The following code fits a mELO model using the <code><a href="../reference/mELO.html">mELO()</a></code> function with a default <span class="math inline">\(k=1\)</span>, learning rates and player 1 advantage parameters.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># Fit model</span>
<span class="no">rps_mELO</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mELO.html">mELO</a></span>(<span class="no">rps_df</span>)
<span class="co"># Display output</span>
<span class="no">rps_mELO</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mELO Ratings For 3 Players Playing 120 Games</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; k = 1.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Player Rating Games Win Draw Loss Lag</span>
<span class="co">#&gt; 1    PAPER 2211.4    80  40    0   40   0</span>
<span class="co">#&gt; 2     ROCK 2194.6    80  40    0   40   1</span>
<span class="co">#&gt; 3 SCISSORS 2193.9    80  40    0   40   0</span></pre></body></html></div>
<p>Predictions can be generated using</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">rps_mELO_preds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(
    <span class="no">rps_mELO</span>,
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">rps_df</span>)
)

<span class="no">results_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">rps_df</span>),
    <span class="kw">mELO_preds</span> <span class="kw">=</span> <span class="no">rps_mELO_preds</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">3</span>)
)
<span class="no">results_df</span> <span class="kw">%&gt;%</span> <span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">time_index</th>
<th align="left">throw_1</th>
<th align="left">throw_2</th>
<th align="right">outcome</th>
<th align="right">mELO_preds</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">PAPER</td>
<td align="left">ROCK</td>
<td align="right">1</td>
<td align="right">0.999</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">ROCK</td>
<td align="left">SCISSORS</td>
<td align="right">1</td>
<td align="right">0.999</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">SCISSORS</td>
<td align="left">PAPER</td>
<td align="right">1</td>
<td align="right">0.999</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">ROCK</td>
<td align="left">PAPER</td>
<td align="right">0</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">SCISSORS</td>
<td align="left">ROCK</td>
<td align="right">0</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">PAPER</td>
<td align="left">SCISSORS</td>
<td align="right">0</td>
<td align="right">0.001</td>
</tr>
</tbody>
</table>
<p>or with the <code><a href="../reference/model_pred_mat.html">model_pred_mat()</a></code> helper function</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/model_pred_mat.html">model_pred_mat</a></span>(
  <span class="no">rps_mELO</span>,
  <span class="no">rps_df</span><span class="kw">[[</span><span class="fl">2</span>]],
  <span class="kw">round</span> <span class="kw">=</span> <span class="fl">3</span>
) <span class="kw">%&gt;%</span>
  <span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">PAPER</th>
<th align="right">ROCK</th>
<th align="right">SCISSORS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>PAPER</td>
<td align="right">0.500</td>
<td align="right">0.999</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td>ROCK</td>
<td align="right">0.001</td>
<td align="right">0.500</td>
<td align="right">0.999</td>
</tr>
<tr class="odd">
<td>SCISSORS</td>
<td align="right">0.999</td>
<td align="right">0.001</td>
<td align="right">0.500</td>
</tr>
</tbody>
</table>
<p>We observe that the mELO predictions are very good. They accurately capture the cyclical, non-transitive properties of the game. We can plot the history of the ratings using the <code><a href="https://rdrr.io/r/base/plot.html">plot()</a></code> function</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">rps_mELO</span>)</pre></body></html></div>
<p><img src="01_introduction_files/figure-html/rps_mELO_3-1.png" width="700"></p>
<p>The mELO ratings quickly stabilise, but we note that the ratings aren’t all equal which we might expect for agents that exhibit perfectly cyclical dynamics. However, the ratings by themselves are not the only things that matter when making predictions from a mELO model. Let <span class="math display">\[
\textbf{A} = \textbf{C} \Omega \textbf{C}' 
\]</span> be the <span class="math inline">\(m \times m\)</span> advantage-disadvantage matrix for our model, where <span class="math inline">\(a_{ij}\)</span> is the advantage agent <span class="math inline">\(i\)</span> has over agent <span class="math inline">\(j\)</span>. mELO uses elements of this matrix when making predictions. The <span class="math inline">\(\textbf{A}\)</span> matrix can be obtained from a mELO model using <code><a href="../reference/get_adv_mat.html">get_adv_mat()</a></code></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/get_adv_mat.html">get_adv_mat</a></span>(<span class="no">rps_mELO</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>()</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">PAPER</th>
<th align="right">ROCK</th>
<th align="right">SCISSORS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>PAPER</td>
<td align="right">0</td>
<td align="right">1118</td>
<td align="right">-1166</td>
</tr>
<tr class="even">
<td>ROCK</td>
<td align="right">-1118</td>
<td align="right">0</td>
<td align="right">1141</td>
</tr>
<tr class="odd">
<td>SCISSORS</td>
<td align="right">1166</td>
<td align="right">-1141</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The advantage-disadvantage estimates are what result in the accurate win probabilities despite the stability and inequality of ratings. The <span class="math inline">\(\textbf{C}\)</span> matrix can be obtained with <code>rps_mELO$c_mat</code> and an array of its history can be obtained using <code>rps_mELO$c_mat_history</code>.</p>
<p>A function has been provided to easily plot the evolution of the <span class="math inline">\(\text{c}\)</span> vectors for each agent</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_c_mat.html">plot_c_mat</a></span>(<span class="no">rps_mELO</span>)</pre></body></html></div>
<p><img src="01_introduction_files/figure-html/rps_mELO_5-1.png" width="700"></p>
</div>
</div>
<div id="rock-paper-scissors-fire-water" class="section level2">
<h2 class="hasAnchor">
<a href="#rock-paper-scissors-fire-water" class="anchor"></a>Rock-Paper-Scissors-<span style="color:red">Fire</span>-<span style="color:blue">Water</span>
</h2>
<p>In this example we will consider a more complex variant of rock-paper-scissors. Here, there are two additional throws, <strong>fire</strong> and <strong>water</strong> which behave according to the figure below</p>
<p align="center">
<img src="images/rpsfw.png"></p>
<p>Observe that fire beats everything except water, and water loses to everything except fire.</p>
<p>Knowing that a regular Elo model will obviously fail to model this situation accurately, we will begin by fitting a mELO model with <span class="math inline">\(k=1\)</span></p>
<div id="melo-model-with-k1" class="section level3">
<h3 class="hasAnchor">
<a href="#melo-model-with-k1" class="anchor"></a>mELO model with <span class="math inline">\(k=1\)</span>
</h3>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">rpsfw_mELO_1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mELO.html">mELO</a></span>(<span class="no">rpsfw_df</span>, <span class="kw">k</span><span class="kw">=</span><span class="fl">1</span>)
<span class="no">rpsfw_mELO_1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mELO Ratings For 5 Players Playing 375 Games</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; k = 1.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Player Rating Games Win Draw Loss Lag</span>
<span class="co">#&gt; 1     FIRE 2371.9   150  90   30   30   2</span>
<span class="co">#&gt; 2     ROCK 2275.8   150  60   30   60   3</span>
<span class="co">#&gt; 3    PAPER 2215.7   150  60   30   60   0</span>
<span class="co">#&gt; 4 SCISSORS 2209.8   150  60   30   60   5</span>
<span class="co">#&gt; 5    WATER 1926.8   150  30   30   90   1</span>

<span class="co"># Sample data to make predictions on</span>
<span class="no">rpsfw_sample_df</span> <span class="kw">&lt;-</span> <span class="no">rpsfw_df</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">outcome</span> <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">time_index</span> <span class="kw">=</span> <span class="fl">NA</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">throw_1</span>, <span class="no">throw_2</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">time_index</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>())

<span class="co"># Get predictions</span>
<span class="no">rpsfw_mELO_preds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(
    <span class="no">rpsfw_mELO_1</span>,
    <span class="no">rpsfw_sample_df</span>
)
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="no">rpsfw_sample_df</span>,
    <span class="kw">mELO_preds</span> <span class="kw">=</span> <span class="no">rpsfw_mELO_preds</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">3</span>)
)
<span class="co">#&gt;    time_index  throw_1  throw_2 outcome mELO_preds</span>
<span class="co">#&gt; 1           1     FIRE    PAPER       1      1.000</span>
<span class="co">#&gt; 2           2     FIRE     ROCK       1      0.998</span>
<span class="co">#&gt; 3           3     FIRE SCISSORS       1      0.991</span>
<span class="co">#&gt; 4           4    PAPER     ROCK       1      0.057</span>
<span class="co">#&gt; 5           5    PAPER    WATER       1      0.998</span>
<span class="co">#&gt; 6           6     ROCK SCISSORS       1      0.923</span>
<span class="co">#&gt; 7           7     ROCK    WATER       1      0.935</span>
<span class="co">#&gt; 8           8 SCISSORS    PAPER       1      0.036</span>
<span class="co">#&gt; 9           9 SCISSORS    WATER       1      0.989</span>
<span class="co">#&gt; 10         10    WATER     FIRE       1      0.979</span></pre></body></html></div>
<p>The predictions are <em>almost</em> right, but according to the rules, paper will always beat rock, and scissors always beat paper. Let’s look at the evolution of the ratings and the  vectors</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">rpsfw_mELO_1</span>)</pre></body></html></div>
<p><img src="01_introduction_files/figure-html/rps_mELO_7-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_c_mat.html">plot_c_mat</a></span>(<span class="no">rpsfw_mELO_1</span>)</pre></body></html></div>
<p><img src="01_introduction_files/figure-html/rps_mELO_7-2.png" width="700"></p>
<p>Further playing around with learning rate parameters and the number of training matches fails to improve these results. Let’s fit a mELO model with <span class="math inline">\(k=2\)</span> which should have more capacity to capture the non-transitive dynamics exhibited here.</p>
</div>
<div id="melo-model-with-k2" class="section level3">
<h3 class="hasAnchor">
<a href="#melo-model-with-k2" class="anchor"></a>mELO model with <span class="math inline">\(k=2\)</span>
</h3>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">rpsfw_mELO_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mELO.html">mELO</a></span>(<span class="no">rpsfw_df</span>, <span class="kw">k</span><span class="kw">=</span><span class="fl">2</span>)
<span class="no">rpsfw_mELO_2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; mELO Ratings For 5 Players Playing 375 Games</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; k = 2.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Player Rating Games Win Draw Loss Lag</span>
<span class="co">#&gt; 1     FIRE 2260.1   150  90   30   30   2</span>
<span class="co">#&gt; 2    PAPER 2211.8   150  60   30   60   0</span>
<span class="co">#&gt; 3 SCISSORS 2201.9   150  60   30   60   5</span>
<span class="co">#&gt; 4     ROCK 2170.7   150  60   30   60   3</span>
<span class="co">#&gt; 5    WATER 2155.4   150  30   30   90   1</span>

<span class="co"># Get predictions</span>
<span class="no">rpsfw_mELO_preds_2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(
    <span class="no">rpsfw_mELO_2</span>,
    <span class="no">rpsfw_sample_df</span>
)

<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="no">rpsfw_sample_df</span>,
    <span class="kw">mELO_preds</span> <span class="kw">=</span> <span class="no">rpsfw_mELO_preds_2</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">3</span>)
)
<span class="co">#&gt;    time_index  throw_1  throw_2 outcome mELO_preds</span>
<span class="co">#&gt; 1           1     FIRE    PAPER       1      0.999</span>
<span class="co">#&gt; 2           2     FIRE     ROCK       1      0.998</span>
<span class="co">#&gt; 3           3     FIRE SCISSORS       1      0.999</span>
<span class="co">#&gt; 4           4    PAPER     ROCK       1      0.998</span>
<span class="co">#&gt; 5           5    PAPER    WATER       1      0.998</span>
<span class="co">#&gt; 6           6     ROCK SCISSORS       1      0.999</span>
<span class="co">#&gt; 7           7     ROCK    WATER       1      0.999</span>
<span class="co">#&gt; 8           8 SCISSORS    PAPER       1      0.998</span>
<span class="co">#&gt; 9           9 SCISSORS    WATER       1      0.999</span>
<span class="co">#&gt; 10         10    WATER     FIRE       1      0.999</span>

<span class="co"># Inspect advantage matrix</span>
<span class="fu"><a href="../reference/get_adv_mat.html">get_adv_mat</a></span>(<span class="no">rpsfw_mELO_2</span>)
<span class="co">#&gt;               FIRE     PAPER      ROCK  SCISSORS     WATER</span>
<span class="co">#&gt; FIRE         0.000  1137.019  1037.469  1078.412 -1275.408</span>
<span class="co">#&gt; PAPER    -1137.019     0.000  1068.633 -1094.378  1057.697</span>
<span class="co">#&gt; ROCK     -1037.469 -1068.633     0.000  1190.589  1174.887</span>
<span class="co">#&gt; SCISSORS -1078.412  1094.378 -1190.589     0.000  1180.526</span>
<span class="co">#&gt; WATER     1275.408 -1057.697 -1174.887 -1180.526     0.000</span></pre></body></html></div>
<p>These predictions are spot on and the <span class="math inline">\(\textbf{A}\)</span> matrix is in line with our expectations. Let’s inspect the historical ratings and  vectors</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">rpsfw_mELO_2</span>)</pre></body></html></div>
<p><img src="01_introduction_files/figure-html/rpsfw_mELO_9-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_c_mat.html">plot_c_mat</a></span>(<span class="no">rpsfw_mELO_2</span>)</pre></body></html></div>
<p><img src="01_introduction_files/figure-html/rpsfw_mELO_9-2.png" width="700"></p>
<p>Whilst an ordinary Elo model and mELO model with <span class="math inline">\(k=1\)</span> fails to capture the dynamics rock-paper-scissors-fire-water, a mELO model with <span class="math inline">\(k=2\)</span> succeeds.</p>
</div>
</div>
</div>
<div id="other-features" class="section level1">
<h1 class="hasAnchor">
<a href="#other-features" class="anchor"></a>Other features</h1>
<p>See the help files for details on the other available functions:</p>
<ul>
<li><code><a href="../reference/model_pred_mat.html">model_pred_mat()</a></code></li>
<li><code><a href="../reference/add_noise_to_outcomes.html">add_noise_to_outcomes()</a></code></li>
<li><code><a href="../reference/c_array_as_df.html">c_array_as_df()</a></code></li>
<li><code>hist_array_as_df()</code></li>
<li><code><a href="../reference/construct_omega.html">construct_omega()</a></code></li>
<li><code><a href="../reference/logloss.html">logloss()</a></code></li>
<li>and <a href="https://dclaz.github.io/mELO/reference/index.html">others</a>…</li>
</ul>
<p>These functions can be used for diagnostic purposes or help prepare data for model outputs for custom plots.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Lazaridis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
